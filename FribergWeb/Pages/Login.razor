@page "/auth/login"
@using FribergShared.Dto
@using FribergWeb.Services
@inject AuthService authService
@inject NavigationManager navManager

<div class="grow flex justify-center items-center h-full w-full p-4">
    <div class="card bg-base-200 shadow-lg hover:shadow-xl transition-shadow w-full max-w-md">
        <div class="card-body flex flex-col gap-4">
            <h2 class="card-title text-center text-2xl font-bold">Login</h2>

            <form @onsubmit="HandleLogin" @formname="login-form" class="flex flex-col gap-4">
                <fieldset class="fieldset w-full">
                    <legend class="fieldset-legend">Username</legend>
                    <input class="input w-full" @bind="Model.UserName" placeholder="Enter your username"
                        disabled="@loading" />
                </fieldset>

                <fieldset class="fieldset w-full">
                    <legend class="fieldset-legend">Password</legend>
                    <input class="input w-full" type="password" @bind="Model.Password" placeholder="Enter your password"
                        disabled="@loading" />
                </fieldset>

                @if (!string.IsNullOrEmpty(Message))
                {
                    <p class="text-red-500 text-center font-medium">@Message</p>
                }

                <button type="submit" class="btn btn-primary w-full mt-2" disabled="@loading">Login</button>

                <NavLink href="/auth/register" class="btn btn-link w-full mt-2 text-center">
                    Don't have an account? Create one
                </NavLink>
            </form>
        </div>
    </div>
</div>


@code {
    LoginDto Model = new LoginDto();
    string Message = "";
    bool loading = false;

    public async Task HandleLogin()
    {
        loading = true;
        Message = "";
        var valid = await authService.LoginAsync(Model);
        if (valid)
        {
            navManager.NavigateTo("/");
        }
        else
        {
            Message = "Username or password is wrong!";
        }
        loading = false;
    }
}