@page "/auth/login"
@using FribergShared.Dto
@using FribergWeb.Services
@inject AuthService authService
@inject NavigationManager navManager

<div class="grow flex justify-center items-center h-full w-full">
    <div class="card">
        <div class="card-body">
            <h2 class="card-title">
                Login
            </h2>
            <form @onsubmit="HandleLogin" @formname="login-form">
                <fieldset class="fieldset">
                    <legend class="fieldset-legend">UserName</legend>
                    <input class="input w-full" @bind="Model.UserName"/>
                </fieldset>
                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Password</legend>
                    <input class="input w-full" type="password" @bind="Model.Password"/>
                </fieldset>
                <p class="text-xl text-red-500">@Message</p>
                <button type="submit" class="btn btn-primary mt-4 w-full">Login</button>
                <NavLink href="/auth/register" class="btn btn-link mt-2">Dont have an account? Create one</NavLink>
            </form>
        </div>
    </div>
</div>

@code {
    LoginDto Model = new LoginDto();
    string Message = "";
    bool loading = false;

    public async Task HandleLogin()
    {
        loading = true;
        Message = "";
        var token = await authService.GetLoginTokenAsync(Model);
        if (string.IsNullOrEmpty(token))
        {
            Message = "Username or password is wrong!";
        }
        else
        {
            navManager.NavigateTo("/");
        }
    }
}